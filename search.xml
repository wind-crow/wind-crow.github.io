<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>WarmUp_writeup</title>
    <url>/2021/10/29/%5BHCTF%202018%5DWarmUp%E7%9A%84write_up/</url>
    <content><![CDATA[<p> 本人菜鸟一个，大佬轻喷。</p>
<span id="more"></span>

<p>打开靶机环境发现就一个笑脸，F12查看网页的前端源码，发现一个source.php的信息</p>
<p>![image-20211101202735658]([HCTF 2018]WarmUp的write_up.assets/image-20211101202735658.png)</p>
<p>打开source.php后，返回的页面中由php代码，现在就是理解给出的php代码</p>
<p>![image-20211102153801692]([HCTF 2018]WarmUp的write_up.assets/image-20211102153801692.png)</p>
<p>接下来我们就需要了解其中的一些函数：</p>
<p>is_string()  函数：检测变量是否是字符串，如果是字符串返回true，否则返回false</p>
<p>in_array()  函数：搜索数组中是否存在指定的值  ，数组中存在指定值返回true，否则返回false</p>
<p>mb_substr() 函数： 从一个字符串中，提取从指定位置开始，一定长度的字符串。如果存在则返回字符串的提取部分，不存在返回false或一个空字符串</p>
<p>mb_strpos() 函数：查找string在一个string首次出现的位置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>]; </span><br><span class="line">            <span class="comment">/*创建了一个关联数组，并给指定键赋值</span></span><br><span class="line"><span class="comment">              与$whitelist[&#x27;source&#x27;] = source.php;</span></span><br><span class="line"><span class="comment">              $whitelist[&#x27;hint&#x27;] = hint.php;语句含义相同 */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//查找$page是否在数组$whitelist中</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//提取从下标为0开始，长度为mb_strpos($page.&#x27;?&#x27;,&#x27;?&#x27;)的字符串</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">                <span class="comment">//在$page字符串加上?,然后在该合成字符串中查找?出现的第一次位置并返回</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$test</span>)</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$test</span>)</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$test</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are true!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>]; <span class="comment">//注意include是文件包含函数()</span></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由之前发现的hint.php文件的信息打开，如下图</p>
<p>![image-20211102154047442]([HCTF 2018]WarmUp的write_up.assets/image-20211102154047442.png)</p>
<p>所以构建hint.php?ffffllllaaaagggg ,hint.php?../ffffllllaaaagggg, hint.php?../../ffffllllaaaagggg等尝试，最后成功试出。</p>
<p>![image-20211102154524705]([HCTF 2018]WarmUp的write_up.assets/image-20211102154524705.png)</p>
]]></content>
      <categories>
        <category>ctf习题</category>
      </categories>
      <tags>
        <tag>writeup</tag>
        <tag>web练习题</tag>
        <tag>BUUCTF</tag>
        <tag>PHP代码审计</tag>
      </tags>
  </entry>
</search>
